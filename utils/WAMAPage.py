#!/usr/bin/env python
#_*_coding:utf-8_*_
#__author__="lihongxing"

from django.db import models
from problem import models
from django.core.paginator import Paginator, EmptyPage, PageNotAnInteger
from datetime import datetime, timedelta
# from itertools import chain

import time

import sys
reload(sys)
sys.setdefaultencoding('utf-8')


def my_page(request,days):
    '''
    WeekAndMonthPage()
    ???????????????????????????????????????????QuerySet??????????
    '''
    #??????????QuerySet??????????????QuerySet????
    lastNumDayAll = models.add_problem.objects.none()
    #?????????
    currentTime= datetime.now()
    for i in range(days):
        num = i + 1
        #???Num??????????
        NumDay = currentTime + timedelta(days=-num)
        #?????Num???????????
        formatDate = NumDay.strftime("%Y-%m-%d")
        # print(formatDate)
        lastNumDay = 'lastNumDay'+str(i)
        #??-id??????id??????????Num???????????
        lastNumDay = models.add_problem.objects.filter(ProblemTime__contains = formatDate).order_by('-id')
        # print(lastNumDay)
        #???QuerySet
        lastNumDayAll = lastNumDayAll | lastNumDay
    # print("----->all:",lastNumdayAll)
    if lastNumDayAll.count() == 0:
        return 0
    #???????7?????
    paginator = Paginator(lastNumDayAll,7)
    page = request.GET.get('page')
    try:
        lastNumDayAll_page = paginator.page(page)
    except PageNotAnInteger:
        lastNumDayAll_page = paginator.page(1)
    except EmptyPage:
        lastNumDayAll_page_page = paginator.page(paginator.num_pages)
    return lastNumDayAll_page